{"version":3,"sources":["index.js"],"names":["blocks","document","querySelectorAll","blocksContainer","querySelector","viewContainer","coef","lastZindex","window","onload","init","onclick","console","log","div","createElement","classList","add","innerHTML","parentNode","value","append","i","length","style","backgroundColor","id","onmousedown","e","moving","block","position","zIndex","eventsNone","onmousemove","moveTo","onmouseup","event","target","inject","building","left","pageX","offsetWidth","top","pageY","offsetHeight","checkPosition","tmp","pointerEvents","findClosest","closest","fromWhere","neighbors","x","getBoundingClientRect","y","neighborY","neighborX","neighborWidth","neighborHeight","closestY","closestX","replaceBlock","from","prepend","setTimeout","remove"],"mappings":"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","file":"blocks.e31bb0bc.js","sourceRoot":"..","sourcesContent":["var blocks = document.querySelectorAll('.blocks-item');\r\nvar blocksContainer = document.querySelector('.blocks');\r\nvar viewContainer = document.querySelector('.view');\r\nvar coef = 25;\r\nvar lastZindex = 1;\r\n\r\nwindow.onload = init;\r\n\r\n//обработчик событий кнопки\r\ndocument.querySelector(\".button.button--add\").onclick = function () {\r\n    console.log()\r\n    var div = document.createElement(\"div\");\r\n    div.classList.add(\"blocks-item\");\r\n    div.innerHTML = this.parentNode.querySelector(\"input\").value;\r\n    blocksContainer.append(div);\r\n    init();\r\n}\r\n\r\n// инициализация\r\nfunction init() {\r\n    blocks = document.querySelectorAll('.blocks-item');\r\n    for (var i = 0; blocks.length > i; i++) {\r\n        blocks[i].style.backgroundColor = blocks[i].innerHTML;\r\n        blocks[i].id = \"block_\" + i;\r\n        blocks[i].onmousedown = function (e) {\r\n            moving(this)\r\n        }\r\n    }\r\n}\r\n\r\nfunction moving(block) {\r\n    block.style.position = \"fixed\";\r\n    block.style.zIndex = \"1\";\r\n    eventsNone(\"none\");\r\n    // событие начала\r\n    document.onmousemove = function (e) {\r\n        moveTo(block);\r\n    }\r\n    // событие окончания\r\n    document.onmouseup = function () {\r\n        if (event.target == blocksContainer || event.target == viewContainer) {\r\n            eventsNone(\"\");\r\n            inject(block);\r\n            building(block);\r\n            document.onmousemove = null;\r\n            block.onmouseup = null;\r\n        }\r\n    }\r\n}\r\n// перемещение за курсором\r\nfunction moveTo(block) {\r\n    block.style.left = event.pageX - block.offsetWidth / 2 + 'px';\r\n    block.style.top = event.pageY - block.offsetHeight / 2 + 'px';\r\n}\r\n// перемещаем в нужный блок\r\nfunction inject(block) {\r\n    checkPosition().append(block)\r\n    if (checkPosition() == blocksContainer) {\r\n        block.style.position = \"\";\r\n        block.style.top = \"\";\r\n        block.style.left = \"\";\r\n    }\r\n}\r\n// проверяем в какой блок попадает\r\nfunction checkPosition() {\r\n    if (event.target == blocksContainer) {\r\n        return blocksContainer;\r\n    }\r\n    if (event.target == viewContainer) {\r\n        return viewContainer;\r\n    }\r\n}\r\n// функция обнуления всех ивентов\r\nfunction eventsNone(tmp) {\r\n    for (var i = 0; blocks.length > i; i++) {\r\n        blocks[i].style.pointerEvents = tmp;\r\n    }\r\n}\r\n\r\nfunction building(block) {\r\n    if (findClosest(block)) {\r\n        var closest = findClosest(block);\r\n        fromWhere(block, closest);\r\n\r\n\r\n        console.log(block,closest)\r\n    }\r\n}\r\n\r\nfunction findClosest(block) {\r\n    if (block.parentNode == viewContainer) {\r\n        var neighbors = block.parentNode.querySelectorAll(\".blocks-item\"),\r\n            x = block.getBoundingClientRect().left,\r\n            y = block.getBoundingClientRect().top;\r\n\r\n        for (var i = 0; i < neighbors.length; i++) {\r\n            if (neighbors[i] != block) {\r\n                var neighborY = neighbors[i].getBoundingClientRect().top,\r\n                    neighborX = neighbors[i].getBoundingClientRect().left,\r\n                    neighborWidth = neighborX + neighbors[i].offsetWidth,\r\n                    neighborHeight = neighborY + neighbors[i].offsetHeight;\r\n\r\n                if (y + block.offsetHeight > neighborY - coef && neighborHeight + coef > y && x + block.offsetWidth > neighborX - coef && neighborWidth + coef > x) {\r\n                    return (neighbors[i])\r\n                }\r\n            }\r\n        }\r\n\r\n    }\r\n}\r\n\r\nfunction fromWhere(block, closest) {\r\n    var closestY = closest.getBoundingClientRect().top,\r\n        closestX = closest.getBoundingClientRect().left,\r\n        y = block.getBoundingClientRect().top,\r\n        x = block.getBoundingClientRect().left;\r\n\r\n    if (y - coef / 2 >= closestY && x + block.offsetWidth / 2 > closestX && x - block.offsetWidth / 2 < closestX) {\r\n        replaceBlock(block, closest, \"down\")\r\n    }\r\n    if (y < closestY + coef / 2 && x + block.offsetWidth / 2 > closestX && x - block.offsetWidth / 2 < closestX) {\r\n        replaceBlock(block, closest, \"up\")\r\n    }\r\n    if (x - coef / 2 >= closestX && y + block.offsetHeight / 2 > closestY && y - block.offsetHeight / 2 < closestY) {\r\n        replaceBlock(block, closest, \"right\")\r\n    }\r\n    if (x < closestX + coef / 2 && y + block.offsetHeight / 2 > closestY && y - block.offsetHeight / 2 < closestY) {\r\n        replaceBlock(block, closest, \"left\")\r\n    }\r\n}\r\n\r\nfunction replaceBlock(block, closest, from) {\r\n    if (from == \"up\") {\r\n        block.classList.add('blocks-item--animate');\r\n        block.style.top = closest.getBoundingClientRect().top + 3 -block.offsetHeight + \"px\";\r\n        block.style.left = closest.getBoundingClientRect().left  + \"px\";\r\n    }\r\n    if (from == \"down\") {\r\n        block.classList.add('blocks-item--animate');\r\n        block.style.top = closest.getBoundingClientRect().top - 3 + block.offsetHeight + \"px\";\r\n        block.style.left = closest.getBoundingClientRect().left +\"px\";\r\n        checkPosition().prepend(block)\r\n    }\r\n    if (from == \"left\") {\r\n        block.classList.add('blocks-item--animate');\r\n        block.style.top = closest.getBoundingClientRect().top - 8 + \"px\";\r\n        block.style.left = closest.getBoundingClientRect().left + 8  - block.offsetWidth + \"px\";\r\n        checkPosition().prepend(block)\r\n    }\r\n    if (from == \"right\") {\r\n        block.classList.add('blocks-item--animate');\r\n        block.style.top = closest.getBoundingClientRect().top + 8 + \"px\";\r\n        block.style.left = closest.getBoundingClientRect().left - 8 + block.offsetWidth + \"px\";\r\n    }\r\n\r\n    setTimeout(() => block.classList.remove('blocks-item--animate'), 301);\r\n}"]}